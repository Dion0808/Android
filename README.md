1.  开发环境和开发工具
客户端：Android Studio Flamingo | 2022.2.1 Patch 2
模拟器：雷电模拟器9.0.61（9）
模拟器机型：SM-G9750（1080×1920 dpi480）
JDK：Java SE 8.0（1.8.0）
SDK：API 28: Android 9.0 (Pie)
2.  基本要求设计
2.1  流程图
2.1.1  用户登录注册系统流程图
用户登录注册系统主要需要实现几个界面的跳转功能，以及需要在各个界面完成指定的任务功能。
 
图2-1  用户登录注册系统流程图
2.1.2  用户登录部分流程图
 
图2-2  用户登录部分流程图
 
2.1.2  用户注册部分流程图
 
图2-3  用户注册部分流程图
2.1.2  用户设置部分流程图
 
图2-4  用户设置部分流程图
2.2  项目的创建
在配置完开发环境和安装好开发工具后，打开Android Studio，点击File-New-New Projec来创建新项目。
 
图2-5  项目创建流程图(一)
在New Project界面选择Empty Views Activity（空视图活动）。
在Android Studio中，Empty Activity是一种预定义的活动模板，用于创建一个空白的视图活动。Empty Views Activity提供了一个简单的布局和代码结构，可用作起点来构建自定义的用户界面。
 
图2-6  项目创建流程图(二)
 
继续点击Next，将项目名称命名为LoginScreenHomeWork，语言选择为Java语言，选择Minimum SDK选择为API 28: Android 9.0 (Pie)，点击Finish即可完成项目的创建，创建完项目后需要等待Android Studio下载相关组件。
 
图2-7  项目创建流程图(三)
2.3  详细界面设计
2.3.1  整体设计思路
整体的页面布局使用的是线性布局的嵌套的方式，顶部采用谷歌的Toolbar导航栏，中间LinearLayout嵌套相应的TextView、EditView和Button。
 
图2-8  以登录界面为例布局示意图
2.3.2  主界面布局设计
一般项目创建好为Android目录格式，设置目录格式为Project模式后，点击LoginScreenHomeWork\app\src\main\java\come.example.loginscreenhomework目录后，右键New-Activity-Empty Views Activity创建MainActivity（下同）。一般项目创建后会自动生成一个MainActivity。视图创建成功后会生成相应的xml文件。
 
图2-9  Activity创建示意图
打开LoginScreenHomeWork\app\src\main\res\layout，找到activity_main.xml文件，设置布局为LinearLayout，即线性布局，设置水平方向为vertical，即垂直方向。
创建一个TextView，用于显示用户登录状态，设置TextView控件的宽度为match_parent，即与上级父视图一致，高度为60dp。控件命名方式为控件英文名缩写-所在视图缩写-内容英文的格式，固设置该控件的id为tv_main_page。设置显示文字为尚未登录，即android:Text="尚未登录"，为了统一方便设置之后的控件显示内容，所以将其写在string文件中。设置文字居中和文字颜色为黑色，即gravity为center，textColor为black。并且设置字体为加粗，所以设置textStyle为bold。这样用于用户登录状态显示的一个控件就设置好了。
接下来创建一个嵌套在LinearLayout的Button按钮，具体方法步骤和上个组件差不多，需要注意的是，为了美观度，需要设置好相应的距离代码，就比如layout_marginTop，它是控制组件与上上方组件的距离，这里是设置成5dp,还有相应的设置与左控件、右控件距离的代码，也要设置好。
 
图2-10  MainActivity布局关键代码示例
 
图2-11  string代码示例
在设置完成后的主界面效果如图2-12所示：
 
图2-12  MainActivity界面运行结果
2.3.3  登录界面布局设计
登录界面的设计和主界面大体思路一致，需要注意的是要在线性布局中再嵌套一个线性布局，再在其中嵌套文本框和输入框，并且要使用水平布局。
 
图2-13  LoginActivity布局关键代码示例
在设置完成后的主界面效果如图2-14所示：
 
图2-14  LoginActivity界面运行结果
2.3.4  注册界面布局设计
注册界面与登录界面也是一致方法，只是需要多嵌套几个LinearLayout，另外还需要注意的是因为是线性布局，所以需要调整按钮所在线性布局与上级视图的距离。
 
图2-15  RegisterActivity布局关键代码示例
在设置完成后的主界面效果如图2-16所示：
 
图2-16  RegisterActivity界面运行结果
2.3.5  输入框和按钮框控件背景样式的设计
在上述布局的设计过程中，使用了背景(background)样式的设计。在默认的的输入框控件下，是只有下划线的样式，而按钮控件也是默认矩形的外形样式。为了一定的美观度需要采用背景样式设计，主要的操作方法是在drawable文件下创建两个名为translucent_button和translucent_edit的xml文件。在按钮样式文件中，设置slold的color为白色(输入框则为灰色)，即它的填充颜色为白色，设置stroke的颜色为黑色（输入框则设置为白色）即它的填充颜色为黑色。并且设置它的圆角角度，即radius设置为20dp，再设置相应的间距距离。
 
图2-17  translucent_button样式关键代码
 
 
图2-18  translucent_edit样式关键代码
2.4  实现过程及代码
2.4.1  主界面代码设计
为相应的控件添加监听，并且设置点击事件代码，将点击事件结果为跳转到登录界面。
 
图2-19  MainActivity控件监听代码
 
图2-20  MainActivity点击结果代码
 
2.4.2  登录界面代码设计
登录界面的控件监听和点击事件效果与主界面一致，多出的两个功能为核验输入的手机号密码和输出登录成功或失败的消息提示。验证手机号密码是否与预设的一致需要用到equals方法，而输出提示信息要用到Toast方法，具体实现方式如图2-21所示。
 
图2-21  LoginActivity关键代码截图
2.4.3  注册界面代码设计
主要代码和方法和上述两个页面代码设计相同，检验两次密码是否相同和验证码是否一致也是采用equals方法，用户名、密码、手机号码使用length方法进行长度判断，符合要求则可以点击发送验证码按钮并且通过Toast方法输出“验证码已发送”的消息。
 
图2-22  RegisterActivity关键代码截图
 
在注册界面注册时点击验证码输出的提示信息如图2-23所示。
 
图2-23  验证码提示信息图
如果登录密码和确认密码不一致，则也会输出相应提示信息，如图2-24所示。
 
图2-24  密码不一致提示信息图
 
B 附加
3.  附加要求设计
3.1  Activity之间消息传递功能设计
实验要求是登录成功后，返回“主页面”，文本显示用户名，按钮显示为“退出”。实际需求是把登录界面的用户名信息传给主界面，即LoginActivity向MainActivity发送数据。具体操作是在登录页面中，在监听器的回调方法中，创建一个新的Intent对象，并使用putExtra()方法将要传递的数据放入Intent中。然后，通过setResult()方法将数据返回给第一个页面，并通过finish()方法关闭第二个页面。
 
图3-1  登录界面数据传递关键代码截图
然后在主页面中，通过startActivityForResult()方法启动第登录页面，并在onActivityResult()方法中获取从第二个页面返回的数据，并将其设置到TextView控件中。并且设置一个是否成功登录标志loginStatus，如果登录成功了，就修改登录按钮的内容为退出，退出登录了则改回内容为登录。
 
图3-2  主界面数据接收关键代码截图
 
实现结果如图3-3所示。
 
图3-3  Activity消息传递结果图
3.2  向上导航功能设计
向上导航功能需要用到Toolbar控件，可以采用的控件是Android Jetpack库自带的androidx.appcompat.widget.Toolbar控件，本次实验本人选择使用的控件是com.google.android.material.appbar.MaterialToolbar。相较于前者，Google的这款提供了更加现代化和符合Material Design风格的外观和样式。设置它的高度为?attr/actionBarSize，即其自定义的高度。设置navigationIcon的内容为attr/homeAsUpIndicator，即其自定义的箭头。并且输入它的标题，也就是类似与我们简单控件的内容一样，这里输入的是当前页面的名字。
 
图3-4  Toolbar布局页面截图
在布局页面设置完Toolbar控件后，需要到AndroidManifest.xml文件，也就是清单文件中去设置Toolbar箭头返回的上级视图。需要在各个视图代码区域内添加一句android:parentActivityName=".父类Activity"，这样系统才知道按下箭头返回上个视图的时候是返回哪个视图，具体代码如下图3-5所示。
 
图3-5  AndroidManifest代码截图
在完成上述基本操作后需要到相应的Java代码中的onCreate方法中添加如图3-6所示的代码。第一行代码的意义是这行代码通过调用findViewById()方法，从布局文件中找到具有指定id的Toolbar控件，并将其赋值给一个名为toolbar 的变量。而第二行代码的意义是将之前获取到的Toolbar对象设置为当前Activity 的操作栏（即支持ActionBar）。通过这个方法，可以使Toolbar替代传统的ActionBar来自定义应用程序的标题栏。最后第三行代码的意义是启用了返回按钮（向上导航按钮），使其显示在Toolbar上。通常情况下，它会显示为一个返回箭头，点击后会回退到前一个页面或上一级。
 
图3-6  Toolbar控件代码截图
向上导航功能示例如图3-7所示，以登录界面为例。
 
图3-7  向上导航示例图
 
3.3  注册信息与登录信息共享设计
要实现注册的账号密码能作为登录的账号密码，最简单的方法是通过类Public变量来共享数据。在com.example.loginscreenhomework文件夹下创建一个名为UserDate的Java类，并在其中定义公共变量用于保存用户注册的账号密码信息，实现代码如图3-8所示。
 
图3-8  UserDate类关键代码截图
然后只要把注册账号时候输入的账号密码保存到UserData类的变量中，并且在登录页面中，获取UserData类中保存的账号密码，并与用户输入的账号密码进行比较，以验证登录，即可实现这个功能。
 
图3-9  注册时保持账号密码关键代码截图
 
图3-10  登录时验证账号密码关键代码截图
 

3.4  style技术的应用
style 技术能通过定义一个或多个全局样式，您可以确保应用程序中的所有组件都具有统一的外观和风格，即统一应用程序的外观。有着高维护性和可扩展性，能将样式定义从布局文件中分离出来，可以使代码更加清晰和易于维护。此外，当需要进行调整或扩展时，style技术使得修改和添加新样式变得更加简单和灵活。当需要更改某个样式时，只需修改样式定义，而不必逐个修改每个组件。
具体的style部分代码如图3-11所示。
 
图3-11  style代码截图
C 自学
4.  自学要求设计
4.1  用户设置页面的设计
在主页面添加一个ImageButton控件，即图片按钮，将准备好的铅笔图片放到drawable文件夹中。需要设置缩放类型为fitCenter，即保持宽高比例，并缩放图片使其位于视图中间，具体布局设计代码如图4-1所示。
 
图4-1  style中ImageButton布局代码截图
ImageButton控件和Button控件是一样的道理，需要给它设置监听和点击事件，使其跳转到用户设置界面，这里就不作赘述。
单选框的布局设计如下图4-2所示，需要注意的是单选的内容要在一个组内，不然运行后会导致选项都能选且不能取消的处境。
 
图4-2  RadioButton布局代码截图
 
CheckBox多选框布局设计如下图4-3所示。
 
图4-3  CheckBox布局代码截图
Spinner是下拉框控件，它用于从一串列表中选择某项，其功能类似于单选按钮的组合。下拉列表的展示方式有两种，一种是在当前下拉框的正下方弹出列表框，此时要把spinnerMode属性设置为dropdown，另一种是在页面中部弹出列表对话框，此时要把spinnerMode属性设置为dialog，本实验采用的是第一种方法。Spinner的布局设置如下图4-4所示。
 
图4-4  Spinner布局代码截图
接着在values文件夹中创建arrays.xml文件，将选项内容编辑进去。
 
图4-5  arrays.xml代码截图
4.2  正则表达式验证功能
主要方法是采用Java中的Pattern和Matcher类来进行正则表达式的匹配，Pattern类用于编译和表示正则表达式，而Matcher 类用于执行匹配操作。首先为各个要输入的内容创建相应的正则表达式，接着用Pattern和Matcher类来进行正则表达式的匹配。正则表达式需要用到的有字符类匹配，如括号[]来定义一个字符类，其中列出的字符代表可能的匹配项，例如[abc]匹配字符'a'、'b' 或 'c' 中的任意一；边界匹配，如^表示行开头的位置，$表示行结尾的位置，例如^a 表示以字母 'a'开头的字符串；以及用^.{n}$中设置n来判定长度。
具体的正则表达式如图4-6所示。
 
图4-6  正则表达式代码截图
Pattern和Matcher类的方法使用如图4-7和4-8所示。
 
图4-7  Pattern和Matcher类代码截图(一)
 
图4-8  Pattern和Matcher类代码截图（二）
4.3  StringBuffer类输出功能
在一般应用Toast输出注册错误提示信息时，会一行一行输出，也就是一次只会输出一个错误信息，这样比较麻烦，如原版每行输出一个错误信息的正则表达式实现结果如图4-9所示，以手机号码不符合规则为例。
 
图4-9  手机号码不符合要求提示图

 
在优化代码后，使用StringBuffer类将每次的错误信息堆积到一起，最后检查是否有错误数目，如果有则输出所有错误信息，实现代码如图4-10和4-11所示，测试代码实现结果如图4-12所示。
 
图4-10  StringBuffer类定义图
 
图4-11  StringBuffer类关键代码图
 
图4-12  StringBuffer类测试图
 
4.4  密码显示与隐藏功能
在原本情况下，可以用android:inputType="textPassword"进行设置默认输入密码隐藏的功能。但是这样的情况下不能在Java代码里面动态修改显示与不可见，只能从可见模式转为可见模式，但是无法转回去。这里有一个解决的方法是使用动态修改TransformationMethod的功能。
ImageView（眼睛显示图像）的布局代码如下图4-13所示。需要注意的是因为采用了线性布局，所以需要设置一个权重才能让它正常显示在屏幕上。另一个需要注意的点是是在Java代码里面设置了图片，如果不想在代码里面设置而是在XML文件里面设置的话，需要输入android:src进行路径设置。
 
图4-13  ImageView布局代码
设置定义ImageView的点击响应函数isShowPassword()。setTransformationMethod是TextView的一个方法，EditText继承于TextView自然可以使用这个方法是用来设置其中text的转换显示，接收的参数是TransformationMethod接口，还有一些系统的默认实现功能例如隐藏回车、不能用换行回车、密码类型等。具体功能实现的代码如图4-14所示。
 
图4-14  密码显示与隐藏功能实现代码
 
在实际测试中的密码隐藏功能如图4-15所示，密码显示功能如图4-16所示。
 
图4-15  密码隐藏功能图

 
图4-16  密码显示功能图
